---
// 圖片模態視窗元件，用於響應式查看圖片
---

<div id="image-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-80 hidden">
  <div class="relative max-w-screen-lg max-h-screen p-4">
    <button id="close-modal" class="absolute top-2 right-2 text-white bg-gray-800 rounded-full p-2 z-10 hover:bg-gray-700">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </button>
    <img id="modal-image" src="" alt="" class="max-w-full max-h-[90vh] object-contain rounded shadow-lg" />
  </div>
</div>

<script>
  function setupImageModal() {
    const modal = document.getElementById('image-modal');
    const modalImage = document.getElementById('modal-image');
    const closeButton = document.getElementById('close-modal');

    if (!modal || !modalImage || !closeButton) return;

    // 為所有圖片添加點擊事件（排除已經在模態視窗中的圖片）
    const images = document.querySelectorAll('img:not(#modal-image)') as NodeListOf<HTMLImageElement>;
    
    images.forEach(img => {
      img.style.cursor = 'pointer';
      img.style.transition = 'transform 0.3s ease';
      
      img.addEventListener('mouseenter', () => {
        img.style.transform = 'scale(1.02)';
      });
      
      img.addEventListener('mouseleave', () => {
        img.style.transform = 'scale(1)';
      });
      
      img.addEventListener('click', () => {
        // 設置模態視窗中的圖片源和alt文字
        (modalImage as HTMLImageElement).src = img.src;
        (modalImage as HTMLImageElement).alt = img.alt || '';
        
        // 顯示模態視窗
        modal.classList.remove('hidden');
        document.body.style.overflow = 'hidden';
      });
    });

    // 關閉模態視窗的函數
    function closeModal() {
      modal.classList.add('hidden');
      document.body.style.overflow = '';
    }

    // 點擊關閉按鈕
    closeButton.addEventListener('click', closeModal);

    // 點擊背景關閉
    modal.addEventListener('click', (e) => {
      if (e.target === modal) {
        closeModal();
      }
    });

    // ESC 鍵關閉
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && !modal.classList.contains('hidden')) {
        closeModal();
      }
    });

    // 防止模態視窗中的圖片點擊事件冒泡
    modalImage.addEventListener('click', (e) => {
      e.stopPropagation();
    });
  }

  // 初始化
  document.addEventListener('DOMContentLoaded', setupImageModal);
  
  // 支持 Astro 動態加載的內容
  document.addEventListener('astro:page-load', setupImageModal);
</script>

<style>
  /* 動畫效果 */
  #image-modal:not(.hidden) {
    animation: fadeIn 0.3s ease-out;
  }

  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  /* 移動設備上的優化 */
  @media (max-width: 640px) {
    #close-modal {
      top: 1rem;
      right: 1rem;
    }
    
    #modal-image {
      max-height: 85vh !important;
    }
  }
</style>
